<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

    
    
    <title>MLargeDataSets.knit</title>

        <script src="MLargeDataSets_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="MLargeDataSets_files/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="MLargeDataSets_files/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="MLargeDataSets_files/navigation-1.1/tabsets.js"></script>
        <link href="MLargeDataSets_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
        <script src="MLargeDataSets_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
        <link href="MLargeDataSets_files/downcute-0.1/downcute.css" rel="stylesheet" />
        <link href="MLargeDataSets_files/downcute-0.1/downcute_fonts_embed.css" rel="stylesheet" />
        <script src="MLargeDataSets_files/downcute-0.1/downcute_styles.js"></script>
        <script src="MLargeDataSets_files/downcute-0.1/downcute.js"></script>
        <script src="MLargeDataSets_files/prism-1.22/prism.js"></script>
    
    
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
               <!-- downcute start -->   
   <div id="docute" class="Root theme-default">
     <div class="Page layout-narrow">
      <div class="Wrap">
        <div class="Sidebar">
          <div class="SidebarItems" id="toc">
            <ul>
            <li><a href="#introduction" id="toc-introduction">Introduction</a></li>
            <li><a href="#data-simulation" id="toc-data-simulation"><span class="toc-section-number">1</span> Data simulation</a>
            <ul>
            <li><a href="#drawing-the-points" id="toc-drawing-the-points"><span class="toc-section-number">1.1</span> Drawing the points</a></li>
            <li><a href="#gridding-the-space" id="toc-gridding-the-space"><span class="toc-section-number">1.2</span> Gridding the space</a></li>
            </ul></li>
            <li><a href="#computing-m-with-the-dbmss-package" id="toc-computing-m-with-the-dbmss-package"><span class="toc-section-number">2</span> Computing <em>M</em> with the <em>dbmss</em> package</a>
            <ul>
            <li><a href="#necessary-data" id="toc-necessary-data"><span class="toc-section-number">2.1</span> Necessary data</a></li>
            <li><a href="#point-pattern" id="toc-point-pattern"><span class="toc-section-number">2.2</span> Point pattern</a></li>
            <li><a href="#distance-matrix" id="toc-distance-matrix"><span class="toc-section-number">2.3</span> Distance matrix</a></li>
            </ul></li>
            <li><a href="#computational-performance" id="toc-computational-performance"><span class="toc-section-number">3</span> Computational performance</a>
            <ul>
            <li><a href="#computing-time" id="toc-computing-time"><span class="toc-section-number">3.1</span> Computing time</a></li>
            <li><a href="#memory" id="toc-memory"><span class="toc-section-number">3.2</span> Memory</a></li>
            </ul></li>
            <li><a href="#effects-of-approximating-the-position-of-points" id="toc-effects-of-approximating-the-position-of-points"><span class="toc-section-number">4</span> Effects of approximating the position of points</a>
            <ul>
            <li><a href="#case-of-an-aggregated-distribution-matérn" id="toc-case-of-an-aggregated-distribution-matérn"><span class="toc-section-number">4.1</span> Case of an aggregated distribution (Matérn)</a></li>
            <li><a href="#case-of-a-completely-random-distribution-csr" id="toc-case-of-a-completely-random-distribution-csr"><span class="toc-section-number">4.2</span> Case of a completely random distribution (CSR)</a></li>
            </ul></li>
            <li><a href="#discussion-and-conclusion" id="toc-discussion-and-conclusion"><span class="toc-section-number">5</span> Discussion and conclusion</a></li>
            <li><a href="#acknowledgements" id="toc-acknowledgements">Acknowledgements</a></li>
            <li><a href="#references" id="toc-references">References</a></li>
            </ul>
          </div>
          <div data-position="sidebar:post-end" class="InjectedComponents"><div class="dark-theme-toggler"><div class="toggle "><div class="toggle-track"><div class="toggle-track-check"><img  src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div> <div class="toggle-track-x"><img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div></div> <div class="toggle-thumb"></div></div> <input type="checkbox" aria-label="Switch between Dark and Default theme" class="toggler-screen-reader-only"></div></div>
        </div>
        <div class="Main">
          <div class="Content" id="content"> 
   
   
        
      <h1 class="title"><div class="line-block">On the Computation of Large Spatial Datasets With the M function</div></h1>
      
      <p class="authors">
           <span class="glyphicon glyphicon-user"></span> Eric Marcon
               <br>
      </p>
           <span class="glyphicon glyphicon-user"></span> Florence Puech
               <br>
      </p>
         <p class="date"><span class="glyphicon glyphicon-calendar"></span> 2024 nov. 21</p>
           

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div class="page-content has-page-title">
<div id="introduction" class="section level1 unnumbered">
<h1>Introduction</h1>
<p>Increasing access to large individual and spatial datasets and greater computing power have encouraged the development of statistical analysis tools for processing such data in the best possible way <span class="citation">(Baddeley et al., 2016)</span>.
Empirical studies at very fine geographical levels have thus been proposed in recent years for large datasets.
Particular attention has been paid to detecting the spatial structures (attraction, repulsion, independence) of individual spatialised data using analyses that are no longer based on zoned data but on geolocalised data.
This type of approach has the advantage of preserving the exact positions of the entities analysed and therefore does not erase individual specificities.
Various studies have shown how important it is to use this type of methodology in many fields, including geography <span class="citation">(Deurloo &amp; De Vos, 2008; Kukuliač &amp; Horák, 2017; Sweeney &amp; Feser, 1998)</span>, economics <span class="citation">(Arbia, 1989; Marcon &amp; Puech, 2003)</span>, ecology <span class="citation">(Cressie, 1993; Lentz et al., 2011)</span>, biology <span class="citation">(Dray et al., 2021)</span>, and so on.
In a recent article proposed in this journal, <span class="citation">Tidu et al. (2024)</span> highlight the interest of a particular statistical measure, the <em>M</em> function proposed by <span class="citation">Marcon &amp; Puech (2010)</span>.
This measure, which we will refer to as <em>M</em> in the remainder of the article, makes it possible to highlight spatial structures within a spatialised distribution (attraction, repulsion, independence) from a study based on the distances separating the entities analysed.
However, while this measure preserves all the richness of individual geolocated data, it requires a longer calculation time than other distance-based measures, since it is both a cumulative and relative measure <span class="citation">(see Marcon &amp; Puech, 2017 for a literature review on the advantages and limitations of a dozen existing distance-based measures)</span>.
<span class="citation">Tidu et al. (2024)</span> propose to limit <em>M</em> calculation times by introducing a voluntary positioning error for the entities analysed.
For example, in their study, industrial establishments in Sardinia (Italy) are no longer located at their exact postal address but at the centroid of their municipality.
This repositioning reduces calculation times, as the number of possible distances between establishments is in fact limited to the distances separating the centroids of the municipalities.
This approach is similar to that of <span class="citation">Scholl &amp; Brenner (2015)</span> who proposed, for the <span class="math inline">\(K_d\)</span> function <span class="citation">(Duranton &amp; Overman, 2005)</span> which characterises spatial structures using another method, to approximate the distances between pairs of entities by grouping them into classes.
The method of <span class="citation">Scholl &amp; Brenner (2015)</span>, implemented in the <em>dbmss</em> package <span class="citation">(Marcon et al., 2015)</span> for R <span class="citation">(R Core Team, 2024)</span> provides a considerable gain in computational performance with little loss of accuracy.</p>
<p>In our paper, we propose to test the effectiveness of <span class="citation">Tidu et al. (2024)</span>’s method.
First, we show the advantages of using the <em>dbmss</em> package to estimate the <em>M</em> function on datasets with an order of magnitude of 100,000 points or less, and we show that the computation times become excessive beyond that, on a personal computer.
We then study the effect of the geographical approximation of the locations of the entities analysed.
This methodological work, based on a deliberately limited number of entity locations, enables us to quantify the extent of the deterioration in information that this approach creates.
These performance tests provide a precise answer to the computational advantages and limitations of the <em>M</em> function as a function of the size of the datasets.</p>
<p>The layout of the article is as follows.
The first section generates the necessary data.
Large point sets (of the order of several tens of thousands of points) that are either completely random or geographically concentrated are drawn.
The second section details the use of the <em>dbmss</em> package to calculate the <em>M</em> function and its confidence interval from a table giving the position and characteristics of the points or a matrix of distances between them.
The third section measures the performance of <em>dbmss</em> as a function of the size of the set of points, in terms of computing time and memory requirements.
The fourth section tests the approximation which consists of grouping them together at the centre of the cells of a grid, following the approach of <span class="citation">Tidu et al. (2024)</span> which positions them at the centre of the administrative units in which they are located.
In the last section, we conclude and discuss the advantages and the limits of an approximation of the locations on the results as well as on the computing time.</p>
</div>
<div id="data-simulation" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Data simulation</h1>
<p>The datasets we will consider in this article are obtained by simulation.
The R code is given in the appendix, which allows perfect reproducibility of the examples treated or the development of others.</p>
<div id="drawing-the-points" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Drawing the points</h2>
<p>A set of points is drawn by a Poisson process (whose expectation of the number of points is 5,000) in a square window of side 1.
Each point is assigned a qualitative mark: ‘Case’ or ‘Control’.
95% of points are ‘Controls’.
5% are ‘Cases’, whose spatial structure is studied.
The weight of the points is drawn from a gamma distribution with free shape and scale parameters.</p>
<p>In this example, the drawing of points is completely random (<em>complete spatial randomness</em>: CSR), i.e. there is no simulation of attraction or dispersion of points which could generate spatial concentrations of points (aggregates) or, on the contrary, spatial regularities (dispersions).
Sets of aggregated points can be drawn in a <span class="citation">Matérn (1960)</span> process.</p>

<p></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:XMaternFig"></span>
<img src="MLargeDataSets_files/figure-html/XMaternFig-1.png" alt="Random draw of a set of points where the Cases (in red) are aggregated and the Controls (in blue) are distributed completely randomly. The size of the points is proportional to their weight." width="100%" />
<p class="caption">
Figure 1.1: Random draw of a set of points where the Cases (in red) are aggregated and the Controls (in blue) are distributed completely randomly. The size of the points is proportional to their weight.
</p>
</div>
<p></p>
<p>The Cases are shown in figure <a href="#fig:XMaternFig">1.1</a>: the aggregates are clearly visible.
The controls are distributed completely randomly.</p>
</div>
<div id="gridding-the-space" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Gridding the space</h2>
<p>Let’s consider the simulation of the Cases obtained by the Matérn process and cut the window into a grid.
It simulates the usual approximation of the position of the points of an administrative unit to the position of its centre.</p>
<p>The approximated position of points is shown on the map in figure <a href="#fig:GroupedFig">1.2</a>.
Each cell now contains only one point of each type, whose weight is the sum of the weights of the individual points.</p>

<p></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:GroupedFig"></span>
<img src="MLargeDataSets_files/figure-html/GroupedFig-1.png" alt="Repositioning of points in an arbitrary grid. The absence of Cases in a cell is easily detected (single-colour blue dot), as is the strong presence of Cases in a cell (two-colour dot, but predominantly red)." width="100%" />
<p class="caption">
Figure 1.2: Repositioning of points in an arbitrary grid. The absence of Cases in a cell is easily detected (single-colour blue dot), as is the strong presence of Cases in a cell (two-colour dot, but predominantly red).
</p>
</div>
<p></p>
<p>The values of the <em>M</em> function can now be calculated from the original point set or its approximation after recentring.</p>
</div>
</div>
<div id="computing-m-with-the-dbmss-package" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Computing <em>M</em> with the <em>dbmss</em> package</h1>
<div id="necessary-data" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Necessary data</h2>
<p>In the <em>dbmss</em> package, the function is applied to a set of points or a distance matrix.
The set of points in figure <a href="#fig:XMaternFig">1.1</a> is used.
The distance matrix between all the pairs of its points is calculated to form the data on which the performance tests will be carried out.</p>
</div>
<div id="point-pattern" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Point pattern</h2>
<p>The <code>Mhat()</code> function in the <em>dbmss</em> package is used to estimate the <em>M</em> function.
The theoretical reference value for <em>M</em> is 1, as this function relates the proportion of Cases up to a distance <span class="math inline">\(r\)</span> to that observed over the entire window.
The aggregation of Cases will be highlighted by values of <em>M</em> greater than 1 (the relative presence of Cases is greater locally than over the whole window) and the dispersion of Cases by values less than 1.
We observe (figure <a href="#fig:MFig">2.1</a>) that <em>M</em> detects an agglomeration of Cases, which is in line with the simulation of this type of point (the controls having a completely random location on the window).
The advantage of a function based on distances is clearly visible: it allows us to detect exactly at which distance(s) the attraction phenomena occur and are the most important (for functions whose values can be compared at different radii, such as <em>M</em>).
In addition to estimating the <em>M</em> function, the <code>Menvelope()</code> function can be used to calculate its global confidence interval <span class="citation">(Duranton &amp; Overman, 2005)</span> under the null hypothesis of random point location.
The result is shown in figure <a href="#fig:MFig">2.1</a>.</p>

<p></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MFig"></span>
<img src="MLargeDataSets_files/figure-html/MFig-1.png" alt="Value of M as a function of distance from the reference point. The confidence interval, simulated at 95%, appears in grey and is centred on the value 1." width="100%" />
<p class="caption">
Figure 2.1: Value of <em>M</em> as a function of distance from the reference point. The confidence interval, simulated at 95%, appears in grey and is centred on the value 1.
</p>
</div>
<p></p>
</div>
<div id="distance-matrix" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Distance matrix</h2>
<p>Matrices can be used to process non-Euclidean distances (transport time, road distance, etc.) which cannot be represented by a set of points.
The <code>Mhat()</code> and <code>MEnvelope()</code> functions are the same, and provide the same results whatever the form of the data used here (point set or distance matrix).</p>
</div>
</div>
<div id="computational-performance" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Computational performance</h1>
<p>The use of the <em>M</em> function to characterise the spatial structure of large sets of points may be limited by the computing time or memory required.</p>
<div id="computing-time" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Computing time</h2>
<p>Calculating the distances between all pairs of points is necessary to estimate <em>M</em>.
The calculation time is therefore expected to increase as the square of the number of points.
The calculation time required for the exact calculation is evaluated for a range of numbers of points (figure <a href="#fig:TestTimeMemFig">3.1</a>a).</p>
<p><strong>The calculation time is related to the size of the set of points by a power law.</strong>
It increases less quickly than the square of the number of points.
It can be estimated very precisely (<span class="math inline">\(R^2=\)</span> 0.98) by the relation <span class="math inline">\(t=t_0 (n/n_o)^p\)</span> where <span class="math inline">\(t\)</span> is the estimated time for <span class="math inline">\(n\)</span> points (e.g.: 5.42 seconds for 100,000 points) knowing the time <span class="math inline">\(t_0\)</span> for <span class="math inline">\(n_0\)</span> points and <span class="math inline">\(p\)</span> is the power relation (here: 1.7).</p>
<p>Using a distance matrix may seem an efficient way of saving computation time, but in reality calculating distances is extremely fast and the whole process from a matrix is ultimately more time-consuming.
The median execution time is equal to 14 milliseconds for estimating the <em>M</em> function from a set of 5,000 points or 23 milliseconds for the corresponding distance matrix.</p>
</div>
<div id="memory" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Memory</h2>

<p></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:TestTimeMemFig"></span>
<img src="MLargeDataSets_files/figure-html/TestTimeMemFig-1.png" alt="Calculation time (a) in seconds and memory required (b) in MB to estimate the M function as a function of the size of the set of points. The bars represent the \(\pm 1\) standard deviation interval." width="100%"  />
<p class="caption">
Figure 3.1: Calculation time (a) in seconds and memory required (b) in MB to estimate the <em>M</em> function as a function of the size of the set of points. The bars represent the <span class="math inline">\(\pm 1\)</span> standard deviation interval.
</p>
</div>
<p></p>
<p>The memory used is evaluated for the same data sizes (figure <a href="#fig:TestTimeMemFig">3.1</a>b).
<strong>The memory required increases linearly with the number of points and is never critical for point set sizes that can be processed in reasonable times.</strong>
This highlights <span class="citation">Tidu et al. (2024)</span>’s conclusion about the power and computation time required when using <em>M</em> on large datasets.
The memory used by <code>Dtable</code> objects to calculate <span class="math inline">\(M\)</span> from a distance matrix is much greater: it is that of a numerical matrix, of the order of 8 bytes times the number of points squared, i.e. 800 MB for 10,000 points only.
As the calculation time is not reduced by this approach, its use should be reserved for non-Euclidean distances.</p>
</div>
</div>
<div id="effects-of-approximating-the-position-of-points" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Effects of approximating the position of points</h1>
<p>Clearly, approximating the position of the points results in a loss of information: in each grid cell, the distance between all the points is set to zero, and the distance between two points in different cells is approximated by the distance between the centroids of the two cells.
We therefore expect a severe error in the estimation of <em>M</em> on a small scale (of the order of magnitude of the size of the cells) and an error that decreases with distance, when the relative size of the cells decreases.
The effect of the location approximation is first tested on a set of aggregated points, similar to the real <span class="citation">Tidu et al. (2024)</span> data.
Secondly, the case of an unstructured set of points is considered.</p>
<div id="case-of-an-aggregated-distribution-matérn" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Case of an aggregated distribution (Matérn)</h2>
<p>100 sets of aggregated points (5,000 points with 5% of Cases) are simulated.
To evaluate the effect of the position approximation, the exact calculation and the calculation on the grid points are performed on each set of points.</p>

<p></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MapproxMaternFig"></span>
<img src="MLargeDataSets_files/figure-html/MapproxMaternFig-1.png" alt="Average estimate of the M function from the exact position of the points compared with the values obtained by grouping the points (a) and correlation between them (b). Cases form aggregates of radius 0.1." width="100%"  />
<p class="caption">
Figure 4.1: Average estimate of the <em>M</em> function from the exact position of the points compared with the values obtained by grouping the points (a) and correlation between them (b). Cases form aggregates of radius 0.1.
</p>
</div>
<p></p>
<p>The mean values of the estimates of <em>M</em> are presented in figure <a href="#fig:MapproxMaternFig">4.1</a>a.
The size of the grid cells is equal to 0.05.
All neighbours at distances less than this threshold are placed at zero distance: the estimate of the function is constant up to this threshold and small-scale aggregation is underestimated.
The correlation between the <em>M</em> values estimated by each method is calculated at each distance (figure <a href="#fig:MapproxMaternFig">4.1</a>b).</p>
<p><strong>The correlation is very close to 1, and the estimated values very similar, as soon as the distance taken into account exceeds the grid cell: the approximation is not a problem if the interactions between the points are studied beyond this distance.</strong>
The information on interactions at short distances, i.e. within each grid cell, is lost, or, more precisely, approximated by its value at the grid scale.</p>
</div>
<div id="case-of-a-completely-random-distribution-csr" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Case of a completely random distribution (CSR)</h2>
<p>The same simulations are run with a completely random set of points.
The exact calculation and the calculation on the grid points are carried out on each set of points.</p>

<p></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:MapproxCSRFig"></span>
<img src="MLargeDataSets_files/figure-html/MapproxCSRFig-1.png" alt="Average estimate of the M function from the exact position of the points compared with the values obtained by grouping the points (a) and correlation between them (b). Both Cases and Controls are drawn in a Poisson process." width="100%"  />
<p class="caption">
Figure 4.2: Average estimate of the <em>M</em> function from the exact position of the points compared with the values obtained by grouping the points (a) and correlation between them (b). Both Cases and Controls are drawn in a Poisson process.
</p>
</div>
<p></p>
<p>The average values are shown in figure <a href="#fig:MapproxCSRFig">4.2</a>a.
The mean value of <em>M</em> is equal to 1 at all distances by construction: Cases and Controls are distributed completely randomly.
The approximations are relatively small in value (a few percent) but artefactual aggregation is generated at small scale.
As the real value of <em>M</em> varies little around 1, the correlations are much weaker (figure <a href="#fig:MapproxCSRFig">4.2</a>b) in the absence of spatial structure than in the aggregated case.</p>
</div>
</div>
<div id="discussion-and-conclusion" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Discussion and conclusion</h1>
<p>To summarise, and based on the cases proposed in this article, two conclusions can be drawn.</p>
<p>Firstly, it seems that <strong>approximation on location can be considered to save computation time, given the strong correlation observed between the values of <em>M</em> on exact and approximated data, but keeping a very fine grid</strong>. Our result is therefore in line with <span class="citation">Tidu et al. (2024)</span>’s article, which mentions strong correlations on Italian company location data.
Since the spatial structure of their data is probably an intermediate case between the two cases dealt with in our article (aggregated and random theoretical distributions), the results provided by our two contributions are complementary. If the aim of the study is to look at spatial structures at very small distances, then approximating geographical positions is not desirable, because the discrepancies between the <em>M</em> results are greatest for these distances.</p>
<p>Secondly, concerning the computing burden, the calculation time for <em>M</em> is around 5 seconds for a set of 100,000 points on a laptop (Intel i7-1360P 2.20 GHz processor), and requires 25 MB of RAM.
Calculating a confidence interval from 1,000 simulations therefore takes less than two hours.
For a set of five million points, the power law predicts around an hour of computing time.
1,000 simulations would then take more than one month.
Thanks to parallelization, a calculation server would drastically increase performance, but at the cost of a complexity of implementation that limits its use.
If we limit ourselves to the computing power of a personal computer, exact calculation is fully justified for data of the order of <span class="math inline">\(10^5\)</span> points: a few hours are enough to calculate confidence intervals.
Beyond that, approximating the location reduces the size of the set of points to the number of locations selected.
The price to pay is the absence of information at the scale of elementary geographical units (the grid cells in this case).
<strong>Depending on the issues addressed, a choice has to be made because this limitation may or may not be acceptable</strong>: the overall description of the spatial structure is not significantly degraded, but the study of externalities, which is particularly interesting at short distances, is very limited.</p>
</div>
<div id="acknowledgements" class="section level1 unnumbered">
<h1>Acknowledgements</h1>
<p>Eric Marcon benefited from an ‘Investissement d’Avenir’ grant managed by the Agence Nationale de la Recherche (LABEX CEBA, ref. ANR-10-LBX-25) and Florence Puech gratefully acknowledges financial support from INRAE.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-Arbia1989" class="csl-entry">
Arbia, G. (1989). <em>Spatial data configuration in statistical analysis of regional economic and related problems</em>. Kluwer.
</div>
<div id="ref-Baddeley2016a" class="csl-entry">
Baddeley, A., Rubak, E., &amp; Turner, R. (2016). <em>Spatial point patterns: Methodology and applications with <span>R</span></em>. CRC Press.
</div>
<div id="ref-Cressie1993" class="csl-entry">
Cressie, N. A. (1993). <em>Statistics for spatial data</em>. John Wiley &amp; Sons.
</div>
<div id="ref-Deurloo2008" class="csl-entry">
Deurloo, M. C., &amp; De Vos, S. (2008). Measuring segregation at the micro level: An application of the <span>M</span> measure to multi-ethnic residential neighbourhoods in <span>Amsterdam</span>. <em>Tijdschrift Voor Economische En Sociale Geografie</em>, <em>99</em>(3), 329–347. <a href="https://doi.org/10.1111/j.1467-9663.2008.00465.x">https://doi.org/10.1111/j.1467-9663.2008.00465.x</a>
</div>
<div id="ref-Dray2021" class="csl-entry">
Dray, N., Mancini, L., Binshtok, U., Cheysson, F., Supatto, W., Mahou, P., Bedu, S., Ortica, S., Than-Trong, E., Krecsmarik, M., Herbert, S., Masson, J.-B., Tinevez, J.-Y., Lang, G., Beaurepaire, E., Sprinzak, D., &amp; Bally-Cuif, L. (2021). Dynamic spatiotemporal coordination of neural stem cell fate decisions occurs through local feedback in the adult vertebrate brain. <em>Cell Stem Cell</em>, <em>28</em>(8), 1457–1472.e12. <a href="https://doi.org/10.1016/j.stem.2021.03.014">https://doi.org/10.1016/j.stem.2021.03.014</a>
</div>
<div id="ref-Duranton2005" class="csl-entry">
Duranton, G., &amp; Overman, H. G. (2005). Testing for localisation using micro-geographic data. <em>Review of Economic Studies</em>, <em>72</em>(4), 1077–1106. <a href="https://doi.org/10.1111/0034-6527.00362">https://doi.org/10.1111/0034-6527.00362</a>
</div>
<div id="ref-Kukuliac2017" class="csl-entry">
Kukuliač, P., &amp; Horák, J. (2017). W function: A new distance-based measure of spatial distribution of economic activities. <em>Geographical Analysis</em>, <em>49</em>(2), 199–214. <a href="https://doi.org/10.1111/gean.12120">https://doi.org/10.1111/gean.12120</a>
</div>
<div id="ref-Lentz2011" class="csl-entry">
Lentz, J. A., Blackburn, J. K., &amp; Curtis, A. J. (2011). Evaluating <span>Patterns</span> of a <span>White-Band Disease</span> (<span>WBD</span>) <span>Outbreak</span> in <span>Acropora</span> palmata <span>Using Spatial Analysis</span>: <span>A Comparison</span> of <span>Transect</span> and <span>Colony Clustering</span>. <em>PLoS ONE</em>, <em>6</em>(7), e21830. <a href="https://doi.org/10.1371/journal.pone.0021830">https://doi.org/10.1371/journal.pone.0021830</a>
</div>
<div id="ref-Marcon2003a" class="csl-entry">
Marcon, E., &amp; Puech, F. (2003). Evaluating the geographic concentration of industries using distance-based methods. <em>Journal of Economic Geography</em>, <em>3</em>(4), 409–428. <a href="https://doi.org/10.1093/jeg/lbg016">https://doi.org/10.1093/jeg/lbg016</a>
</div>
<div id="ref-Marcon2010" class="csl-entry">
Marcon, E., &amp; Puech, F. (2010). Measures of the geographic concentration of industries: <span>Improving</span> distance-based methods. <em>Journal of Economic Geography</em>, <em>10</em>(5), 745–762. <a href="https://doi.org/10.1093/jeg/lbp056">https://doi.org/10.1093/jeg/lbp056</a>
</div>
<div id="ref-Marcon2012c" class="csl-entry">
Marcon, E., &amp; Puech, F. (2017). A typology of distance-based measures of spatial concentration. <em>Regional Science and Urban Economics</em>, <em>62</em>, 56–67. <a href="https://doi.org/10.1016/j.regsciurbeco.2016.10.004">https://doi.org/10.1016/j.regsciurbeco.2016.10.004</a>
</div>
<div id="ref-dbmss" class="csl-entry">
Marcon, E., Traissac, S., Puech, F., &amp; Lang, G. (2015). Tools to characterize point patterns: <span class="nocase">dbmss</span> for <span>R</span>. <em>Journal of Statistical Software, Code Snippets</em>, <em>67</em>(3), 1–15. <a href="https://doi.org/10.18637/jss.v067.c03">https://doi.org/10.18637/jss.v067.c03</a>
</div>
<div id="ref-Matern1960" class="csl-entry">
Matérn, B. (1960). Spatial variation. <em>Meddelanden Fr<span>å</span>n Statens Skogsforskningsinstitut</em>, <em>49</em>(5), 1–144.
</div>
<div id="ref-R" class="csl-entry">
R Core Team. (2024). <em>R: <span>A</span> language and environment for statistical computing</em>. R Foundation for Statistical Computing.
</div>
<div id="ref-Scholl2013" class="csl-entry">
Scholl, T., &amp; Brenner, T. (2015). Optimizing distance-based methods for large data sets. <em>Journal of Geographical Systems</em>, <em>17</em>(4), 333–351. <a href="https://doi.org/10.1007/s10109-015-0219-1">https://doi.org/10.1007/s10109-015-0219-1</a>
</div>
<div id="ref-Sweeney1998" class="csl-entry">
Sweeney, S. H., &amp; Feser, E. J. (1998). Plant size and clustering of manufacturing activity. <em>Geographical Analysis</em>, <em>30</em>(1), 45–64. <a href="https://doi.org/10.1111/j.1538-4632.1998.tb00388.x">https://doi.org/10.1111/j.1538-4632.1998.tb00388.x</a>
</div>
<div id="ref-Tidu2023" class="csl-entry">
Tidu, A., Guy, F., &amp; Usai, S. (2024). Measuring spatial dispersion: An experimental test on the <span><em>M</em></span>-index. <em>Geographical Analysis</em>, <em>56</em>, 384–403. <a href="https://doi.org/10.1111/gean.12381">https://doi.org/10.1111/gean.12381</a>
</div>
</div>
</div>
</div>

   
   
              </div>
  </div>
  </div>
  </div>
   
      

  <script>
    $(document).ready(function () {

		// add bootstrap table styles to pandoc tables
	$('tr.header').parent('thead').parent('table').addClass('table table-condensed');
		
 		
		$('#content img:not(.no-lightbox)').addClass("image-lb");
	$('#content').magnificPopup({
	    type:'image',
	    closeOnContentClick: false,
	    closeBtnInside: false,
	    delegate: '.image-lb',
	    gallery: {enabled: false },
	    image: {
	        verticalFit: true,
		titleSrc: 'alt'
	    }
 	});
 	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
